01234567890123456789
 1| 2| 3| 4| 5| 6
11|22|23|64|35|16 


[ ] независимо инкрементит номера в очередях
[ ] добавление в очередь
[ ] зацикливание начало конец. без перезода через начало
[ ] добавить экран для вывода номера нового пользователя
[ ] отправка по i2c

[ ] исправить переполнение очереди
 


.include "8515def.inc"	
.def temp = r16				
.org $000
		rjmp init
INIT:		
		ldi temp, 0b00111111		 ; èíèöèàëèçèðóåì ââîä íà PA.6 è PA.7 
		out DDRA, temp	 
		ldi temp, 0b11000000        
		out PORTA,temp		 
		
		ldi temp, 0b00000011		 ; èíèöèàëèçèðóåì âûâîä íà PB.0 è PB.1
		out DDRB, temp		 
		ldi temp, 0b00000001	 ; PB.0 = 1 (ñâåòîäèîä âûêëþ÷åí ïðè 1, òàê êàê ðåçèñòîð ïîäòÿãèâàþùèé), PB.1 = 0 (ñâåòîäèîä âûêëþ÷åí ïðè 0, òàê êàê ðåçèñòîð ñòÿãèâàþùèé)
		out PORTB, temp		 
LOOP: 			 
		in temp, PINA
		sbrc temp, 6     	 ; çàæàòà ëè SW1 (PA.6 == 0)
		rjmp CLEAR_PB0       ; åñëè íå çàæàòà SW1, òî âûêëþ÷àåì PB.0 è ïðîâåðÿåì, çàæàòà ëè SW2
		
		cbi PORTB, 0       ; åñëè çàæàòà, òî çàãîðàåòñÿ PB.0 (ïîäàåì 0 â 0-îé áèò, òàê êàê ðåçèñòð ïîäòÿãèâàþùèé)
SW2_CHECK:
	        in temp, PINA
	        sbrc temp, 7     	 ; çàæàòà ëè SW2 (PA.7 == 0)
		rjmp CLEAR_PB1                ; åñëè íå çàæàòà SW2, òî âûêëþ÷àåì PB.1 è ïåðåõîäèì ê ïðîâåðêå, çàæàòà ëè SW1
		
		sbi PORTB, 1             ; åñëè çàæàòà, òî çàãîðàåòñÿ PB.1 (ïîäàåì 1 â 1-ûé áèò, òàê êàê ðåçèñòð ñòÿãèâàþùèé)
		rjmp LOOP
CLEAR_PB0:
		 sbi PORTB, 0             ; åñëè íå çàæàòà, òî âûêëþ÷àåì PB.0 (ïîäàåì 0 â 0-îé áèò)
		 rjmp SW2_CHECK
CLEAR_PB1:
		 cbi PORTB, 1             ; åñëè íå çàæàòà, òî âûêëþ÷àåì PB.1 (ïîäàåì 0 â 1-ûé áèò)
		 rjmp LOOP